<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>미래 월급 테스트</title>
    <meta property="og:url" content="https://future-salary-test.pages.dev">
    <meta property="og:type" content="website">
    <meta name="description" content="AI가 당신의 미래 월급을 예측해드립니다. 무료 관상 테스트를 통해 당신의 운명적인 연봉을 확인하고, 재물운을 높이는 관상학 칼럼을 확인하세요.">
    <meta name="keywords" content="무료 관상 테스트, AI 연봉 예측, 미래 월급, 관상학, 재물운, 운명, 셀카 관상, 얼굴 분석, 연봉 테스트">
    <meta property="og:title" content="AI 미래 월급 테스트">
    <meta property="og:description" content="내 관상으로 보는 미래 연봉은 얼마일까? 지금 바로 확인하세요!">
    <meta property="og:image" content="">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>💰</text></svg>">
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script> <!-- Confetti library -->
    <!-- Kakao SDK -->
    <script src='https://t1.kakaocdn.net/kakao_js_sdk/2.7.1/kakao.min.js' integrity='sha384-kDljxUXHaJ9xAb2AzRd59KxjrFjzHa5TAoFQ6GbYTCAG0bjM55XohjjDT7tDDC01' crossorigin='anonymous'></script>
    <style>
        /* Global & Reset Styles */
        * {
            box-sizing: border-box;
        }
        html {
            scroll-behavior: smooth;
            scroll-padding-top: 60px; /* Offset for fixed header height */
        }
        body {
            font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            padding: 0;
            color: #333;
            text-align: center;
            line-height: 1.6;
        }

        /* Header Styles */
        #main-header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 60px;
            z-index: 1000;
            background-color: #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px; /* Added padding */
            box-sizing: border-box; /* Added box-sizing */
        }
        .header-logo {
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
        }
        #hamburger-btn {
            background: none;
            border: none;
            font-size: 24px; /* Adjusted font-size */
            cursor: pointer; /* Added cursor pointer */
            color: #333;
            display: block;
        }

        /* Mobile Menu Styles */
        #mobile-menu {
            position: fixed;
            top: 0;
            right: -100%; /* Initially hidden */
            width: 250px;
            max-width: 80%; /* Responsive width */
            height: 100%;
            background-color: #f8f8f8;
            box-shadow: -2px 0 5px rgba(0,0,0,0.1);
            z-index: 1001;
            transition: right 0.3s ease-in-out;
            display: flex;
            flex-direction: column;
            padding-top: 60px; /* Space below header */
        }
        #mobile-menu.open {
            right: 0; /* Slide in */
        }
        #close-menu-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            font-size: 2em;
            cursor: pointer;
            color: #333;
            display: block; /* Ensure it's visible */
        }
        #mobile-menu ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        #mobile-menu li {
            border-bottom: 1px solid #eee; /* Separator for menu items */
        }
        #mobile-menu li:last-child {
            border-bottom: none;
        }
        .menu-item {
            display: block;
            padding: 15px 20px;
            text-decoration: none;
            color: #333;
            font-size: 1.1em;
        }
        .menu-item:hover {
            background-color: #e9e9e9;
        }
        
        /* Main Content Container (redefined for layout reset) */
        .container { /* This targets #home-section */
            background-color: #ffffff;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            max-width: 600px; /* User specified */
            width: 100%;
            display: flex; /* For internal flex layout */
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin: 80px auto 0; /* User specified margin-top for header offset + auto for centering */
            position: relative; /* For z-index or other positioning if needed */
        }

        /* General element styles (previously inline or in original .container) */
        h1 {
            color: #333;
            margin-bottom: 15px;
            font-size: 2.5em;
            font-weight: 900;
        }
        .mode-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .mode-button {
            background: #f0f2f5;
            color: #555;
            border: none;
            border-radius: 20px;
            padding: 10px 20px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .mode-button.active, .mode-button:hover {
            background: linear-gradient(45deg, #007bff, #0056b3);
            color: white;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .input-section {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        /* File Upload Styles */
        .file-upload-wrapper {
            width: 100%;
            position: relative;
        }
        .file-upload-label {
            display: inline-block;
            background: linear-gradient(45deg, #4CAF50, #66BB6A);
            color: white;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1em;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        .file-upload-label:hover {
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
            transform: translateY(-2px);
        }
        #image-upload {
            display: none;
        }

        /* Webcam Styles */
        #webcam-view {
            width: 100%;
            max-width: 400px;
            border-radius: 10px;
            border: 2px solid #ddd;
            display: none;
        }
        #webcam-button {
            background: linear-gradient(45deg, #FFC107, #FFA000);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 12px 25px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            width: 80%;
            max-width: 250px;
            display: none;
        }
        #webcam-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
        }

        #image-preview {
            max-width: 100%;
            max-height: 250px;
            height: auto;
            border-radius: 10px;
            border: 2px dashed #ddd;
            object-fit: contain;
            margin-top: 15px;
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }

        #check-salary-button, #share-button {
            background: linear-gradient(45deg, #007bff, #0056b3);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 15px 30px;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            width: 80%;
            max-width: 300px;
            margin-top: 20px;
        }
        #kakao-share-button, #reset-button {
            background-color: #FEE500;
            color: #3C1E1E;
            border: none;
            border-radius: 25px;
            padding: 15px 30px;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            width: 80%;
            max-width: 300px;
            margin-top: 10px;
        }
        #share-button {
            margin-top: 20px;
        }
        #check-salary-button:hover, #share-button:hover, #kakao-share-button:hover, #reset-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }
        #check-salary-button:disabled {
            background: linear-gradient(45deg, #cccccc, #aaaaaa);
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }
        
        #loading-message {
            font-size: 1.5em;
            font-weight: bold;
            color: #555;
            margin-top: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            display: none; 
        }
        /* CSS Spinner */
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #007bff;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        #result-text {
            font-size: 2.2em;
            font-weight: 900;
            color: #2c3e50;
            margin-top: 30px;
            word-break: keep-all;
            line-height: 1.4;
        }
        #salary-amount {
            font-size: 2.8em;
            font-weight: bold;
            color: #007bff;
            margin-top: 10px;
        }

        /* Tech Info Section */
        #tech-info {
            width: 100%;
            max-width: 600px; /* Aligned with container max-width */
            margin: 40px auto 0; /* Space from above and center */
            padding: 25px;
            background-color: #f8f9fa;
            border-radius: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            text-align: left;
            color: #333;
        }
        #tech-info h2 {
            font-size: 1.8em;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 700;
        }
        #tech-info > div { /* Direct children div for sections */
            margin-bottom: 25px;
        }
        #tech-info > div:last-child {
            margin-bottom: 0;
        }
        #tech-info h3 {
            font-size: 1.3em;
            color: #0056b3;
            margin-bottom: 10px;
            font-weight: 600;
        }
        #tech-info p {
            font-size: 0.95em;
            line-height: 1.6;
            color: #555;
        }
        #tech-info strong {
            color: #0056b3;
        }
        /* Privacy Emphasis */
        #tech-info div:nth-of-type(2) h3 {
            color: #d9534f;
        }
        #tech-info div:nth-of-type(2) p, #tech-info div:nth-of-type(2) strong {
            color: #d9534f;
            font-weight: bold;
        }

        /* Blog Section */
        #blog-section {
            width: 100%;
            max-width: 600px; /* Aligned with container max-width */
            margin: 40px auto 0; /* Space from above and center */
            text-align: left;
            background-color: #f9f9f9;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        #blog-section h2 {
            font-size: 1.8em;
            color: #333;
            margin-bottom: 25px;
            text-align: center;
            font-weight: 700;
        }
        .blog-article {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        .blog-article:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        .blog-article h3 {
            font-size: 1.3em;
            color: #007bff;
            margin-bottom: 10px;
            font-weight: 600;
        }
        .blog-article p {
            font-size: 0.95em;
            line-height: 1.6;
            color: #555;
        }

        /* Footer Styles */
        #footer {
            margin-top: 40px;
            padding: 20px;
            text-align: center;
            font-size: 0.85em;
            color: #777;
        }
        #footer p {
            margin-bottom: 10px;
        }
        #footer a {
            color: #777;
            text-decoration: none;
            margin: 0 10px;
        }
        #footer a:hover {
            text-decoration: underline;
        }

        /* Responsive adjustments */
        @media (max-width: 600px) {
            #main-header {
                padding: 0 15px;
            }
            .header-logo {
                font-size: 1.3em;
            }
            #hamburger-btn {
                font-size: 1.8em;
            }
            #mobile-menu {
                width: 70%; /* Adjust width for smaller screens */
            }
            .container, #tech-info, #blog-section {
                padding: 20px;
                margin-left: 10px;
                margin-right: 10px;
            }
            .container { /* Specific adjustment for main content container */
                 margin-top: 70px; /* A bit more top margin for smaller screens */
            }
        }
    </style>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8318272387440643"
     crossorigin="anonymous"></script>
</head>
<body>
    <header id="main-header">
        <div class="header-logo">미래 월급 테스트</div>
        <button id="hamburger-btn">☰</button>
    </header>

    <!-- Slide-in Menu -->
    <nav id="mobile-menu">
        <button id="close-menu-btn">X</button>
        <ul>
            <li><a href="#home-section" class="menu-item">홈으로</a></li>
            <li><a href="#blog-section" class="menu-item">관상학 칼럼</a></li>
            <li><a href="#tech-info" class="menu-item">서비스 소개</a></li>
            <li><a href="#footer" class="menu-item">문의하기</a></li>
        </ul>
    </nav>

    <!-- Main Content Container -->
    <div id="home-section" class="container">
        <h1>미래 월급 테스트 💰</h1>
        <div class="mode-buttons">
            <button id="upload-mode-btn" class="mode-button active">📸 사진 업로드</button>
            <button id="webcam-mode-btn" class="mode-button">📷 카메라로 찍기</button>
        </div>

        <div id="upload-section" class="input-section">
            <div class="file-upload-wrapper">
                <label for="image-upload" class="file-upload-label">파일 선택</label>
                <input type="file" id="image-upload" accept="image/*">
            </div>
        </div>

        <div id="webcam-section" class="input-section" style="display: none;">
            <video id="webcam-view" playsinline autoplay></video>
            <button id="webcam-button">셀카 찍기</button>
            <canvas id="webcam-canvas" style="display: none;"></canvas>
        </div>
        
        <img id="image-preview" src="#" alt="미리보기 이미지">
        <button id="check-salary-button" disabled>월급 확인하기</button>
        <!-- Loading message with spinner -->
        <p id="loading-message">
            <span class="spinner"></span> AI가 분석 중입니다...
        </p>
        <p id="result-text"></p>
        <p id="salary-amount"></p> <!-- Add element for numerical salary -->
        <button id="share-button" style="display:none;">🔗 결과 공유하기</button> <!-- Web Share button -->
        <button id="kakao-share-button" style="display:none;">💬 카카오톡 공유하기</button> <!-- Kakao Share button -->
        <button id="reset-button" style="display:none;">🔄 다시하기</button> <!-- Reset button -->
    </div>

    <!-- 기술 정보 및 개인정보 섹션 -->
    <section id="tech-info">
        <h2>서비스 소개 및 기술 정보 ⚙️</h2>
        
        <div>
            <h3>✨ AI 분석 알고리즘</h3>
            <p>
                저희 서비스는 구글의 최신 머신러닝 플랫폼인 <strong>Teachable Machine 2.0</strong>과 강력한 JavaScript 기반의 머신러닝 라이브러리인 <strong>TensorFlow.js</strong>를 활용하여 제작되었습니다. 이는 단순한 재미를 위한 랜덤 게임이 아닙니다. 수많은 관상 데이터를 학습하여 인공지능 모델이 사용자의 얼굴 특징을 정교하게 분석하여 미래 월급을 예측하는 알고리즘을 사용합니다. 웹 표준 기술을 기반으로 구현되어 별도의 앱 설치 없이 어디서든 접근 가능하며, 높은 기술적 완성도를 자랑합니다.
            </p>
        </div>

        <div>
            <h3>🔒 프라이버시 보안 강조: 사진이 서버로 전송되나요?</h3>
            <p>
                절대 전송되지 않습니다. 모든 분석 과정은 사용자의 기기(브라우저) 내에서 <strong>클라이언트 사이드 스크립트로만 처리됩니다.</strong> 따라서 사용자의 사진 데이터가 외부 서버로 전송되거나 저장될 걱정이 전혀 없습니다. 안심하고 서비스를 이용해주세요!
            </p>
        </div>
    </section>

    <!-- 관상학 칼럼 섹션 -->
    <div id="blog-section">
        <h2>관상학 칼럼 📰</h2>
        
        <div class="blog-article">
            <h3>✨ 부자 관상의 특징 5가지</h3>
            <p>
                관상학에서 부자의 상을 논할 때 가장 중요하게 보는 것은 이마, 눈썹, 눈, 코, 입, 그리고 귀의 생김새입니다. 첫째, 넓고 봉긋하며 흠집 없는 이마는 일찍부터 성공하고 재물운이 따르는 길상으로 봅니다. 이는 지혜와 사회적 성공을 의미하며, 특히 이마 양 옆의 관록궁이 발달하면 명예와 직위가 높아진다고 해석됩니다. 둘째, 가지런하고 윤기 있는 눈썹은 인복과 형제복을 상징하며, 눈썹이 길고 짙되 눈을 찌르지 않으면 주변의 도움으로 재물을 모으기 쉽습니다. 셋째, 맑고 깊이 있는 눈은 총명함과 통찰력을 나타내며, 특히 눈동자가 크고 빛나면 재물을 지키고 불릴 능력이 탁월하다고 봅니다. 눈 밑 애교살이 도톰하면 자식 복과 더불어 노년의 행복까지 점칠 수 있습니다. 넷째, 크고 곧게 뻗은 코는 재복과 자존심을 상징합니다. 콧방울이 두툼하고 콧대가 반듯하면 재물이 쌓이고 재산을 모으는 능력이 뛰어납니다. 다섯째, 입술이 도톰하고 입꼬리가 위로 살짝 올라간 입은 언변이 좋고 사람을 끄는 매력이 있어 사업이나 사회생활에서 성공할 가능성이 높습니다. 입이 크고 다물어졌을 때 빈틈이 없으면 재물이 새지 않는다고 해석됩니다. 마지막으로 귀는 크고 두툼하며 귓불이 길면 장수와 재물을 동시에 누리는 좋은 관상으로 여겨집니다.
            </p>
        </div>
        
        <div class="blog-article">
            <h3>💰 재물운을 부르는 습관</h3>
            <p>
                재물운은 단순히 관상으로만 결정되는 것이 아니라, 일상생활의 습관을 통해 얼마든지 개선하고 증진시킬 수 있습니다. 첫째, 청결하고 정돈된 환경을 유지하는 것입니다. 특히 집 안의 현관, 거실, 침실은 기운이 드나들고 머무는 중요한 공간이므로 항상 깨끗하게 유지해야 합니다. 어지러운 환경은 재물운의 흐름을 방해한다고 관상학에서는 강조합니다. 둘째, 긍정적인 사고방식과 감사하는 마음을 갖는 것입니다. 부정적인 생각은 에너지를 소모하고 좋은 기운을 멀리하게 만듭니다. 작은 일에도 감사하고 긍정적인 태도를 유지하려 노력하면 주변에 좋은 인연과 기회가 따르게 됩니다. 셋째, 절약하는 습관을 들이고 무분별한 지출을 삼가는 것입니다. 재물은 들어오는 것도 중요하지만 나가는 것을 막는 것이 더욱 중요합니다. 불필요한 소비를 줄이고 저축과 투자를 통해 자산을 불려나가는 지혜로운 자세가 필요합니다. 넷째, 꾸준히 배우고 성장하는 자세를 갖는 것입니다. 지식과 경험은 곧 새로운 기회를 만들고 재물을 창출하는 원동력이 됩니다. 독서, 세미나 참석, 새로운 기술 습득 등 자기계발을 게을리하지 않아야 합니다. 다섯째, 주변 사람들과 좋은 관계를 유지하는 것입니다. 인맥은 곧 정보와 기회의 통로가 됩니다. 특히 어려운 사람을 돕고 베푸는 마음은 복이 되어 돌아온다는 것이 관상학적 조언입니다.
            </p>
        </div>

        <div class="blog-article">
            <h3>🤔 내 관상, AI는 어떻게 분석할까?</h3>
            <p>
                현대의 관상학은 고대의 지혜와 최신 기술의 융합을 통해 새로운 지평을 열고 있습니다. 특히 인공지능(AI) 기반의 관상 분석은 수많은 얼굴 데이터를 학습하여 특정 얼굴 특징과 통계적 상관관계를 도출해냅니다. AI는 사람의 얼굴에서 눈, 코, 입, 이마 등 주요 부위의 형태, 비율, 위치 등을 정밀하게 측정하고, 이를 과거의 성공 또는 실패 사례 데이터와 비교 분석합니다. 예를 들어, 특정 형태의 코를 가진 사람들이 경제적으로 성공할 확률이 높다는 데이터가 있다면, AI는 이러한 패턴을 학습하여 새로운 얼굴 이미지에도 적용하는 방식입니다. 물론 AI 관상 분석은 100% 정확한 미래 예측 도구라기보다는, 재미있고 흥미로운 자기 탐색의 도구로 활용될 수 있습니다. AI는 학습된 데이터를 기반으로 확률적인 결과를 제시하며, 이는 개인의 노력과 환경에 따라 얼마든지 달라질 수 있습니다. 중요한 것은 AI 분석 결과를 통해 자신을 이해하고, 긍정적인 방향으로 삶을 이끌어 나가는 계기로 삼는 것입니다. 본 테스트 역시 이러한 AI 기반의 관상 분석 원리를 활용하여 여러분의 미래 월급을 예측해 드립니다.
            </p>
        </div>
    </div>

    <footer id="footer">
        <p>&copy; 2026 미래 월급 테스트. All rights reserved.</p>
        <p>
            <a href="terms.html">이용약관</a> |
            <a href="privacy.html">개인정보처리방침</a> |
            <a href="mailto:rkd743194@gmail.com">문의하기</a>
        </p>
    </footer>

    <script type="text/javascript">
        const URL = "https://teachablemachine.withgoogle.com/models/OgIgQ0pYA/";
        
        const richMessages = [
            '숨만 쉬어도 돈이 들어오는 관상',
            '걸어 다니는 중소기업',
            '전생에 나라를 구함',
            '조물주 위에 건물주',
            '재벌 3세의 기운이 느껴짐'
        ];
        const middleClassMessages = [
            '어딜 가나 환영받는 인재',
            '워라밸을 즐기는 능력자',
            '부장님 소리 듣는 관상',
            '실속 챙기는 알부자',
            '안정적인 자산가'
        ];
        const poorMessages = [
            '티끌 모아 태산! 성실함이 무기',
            '대기만성형! 늦게 터집니다',
            '돈보다 명예를 좇는 예술가',
            '지금은 힘들어도 끝은 창대하리라',
            '로또 당첨을 노려보세요'
        ];
        let model, maxPredictions;
        let webcamStream = null; // To store webcam stream

        // DOM elements
        const uploadModeBtn = document.getElementById('upload-mode-btn');
        const webcamModeBtn = document.getElementById('webcam-mode-btn');
        const uploadSection = document.getElementById('upload-section');
        const webcamSection = document.getElementById('webcam-section');
        const imageUpload = document.getElementById('image-upload');
        const imagePreview = document.getElementById('image-preview');
        const webcamView = document.getElementById('webcam-view');
        const webcamCanvas = document.getElementById('webcam-canvas');
        const webcamButton = document.getElementById('webcam-button');
        const checkSalaryButton = document.getElementById('check-salary-button');
        const loadingMessage = document.getElementById('loading-message');
        const resultText = document.getElementById('result-text');
        const salaryAmountDisplay = document.getElementById('salary-amount'); // New element
        const shareButton = document.getElementById('share-button'); // Web Share button element
        const kakaoShareButton = document.getElementById('kakao-share-button'); // Kakao Share button element
        const resetButton = document.getElementById('reset-button'); // Reset button element

        let currentMode = 'upload'; // Initial mode

        // Initialize Kakao SDK
        // Kakao.init should be called outside of async functions
        // It needs to be called after the SDK script is loaded.
        if (Kakao && !Kakao.isInitialized()) {
            Kakao.init('783d4abe65a9e7fd57276ee69d32fc04');
            console.log('Kakao SDK initialized:', Kakao.isInitialized());
        }


        async function init() {
            const modelURL = URL + "model.json";
            const metadataURL = URL + "metadata.json";

            model = await tmImage.load(modelURL, metadataURL);
            maxPredictions = model.getTotalClasses();
            
            console.log("Teachable Machine 모델 로드 완료!");
            // Initially ensure UI matches currentMode
            switchMode(currentMode);
        }

        // --- Confetti Function ---
        function triggerConfetti() {
            const confettiEmojis = ['💸', '💰']; // Emojis for confetti
            const defaults = {
                spread: 360,
                ticks: 50,
                gravity: 0.5,
                decay: 0.94,
                startVelocity: 30,
                colors: ['#FFD700', '#C0C0C0', '#DAA520', '#FFFFFF'] // Gold, Silver, Goldenrod, White
            };

            function fire(particleRatio, opts) {
                confetti(Object.assign({}, defaults, opts, {
                    particleCount: Math.floor(200 * particleRatio),
                    shapes: ['emoji'],
                    shapeOptions: {
                        emoji: confettiEmojis
                    }
                }));
            }

            fire(0.25, {
                spread: 26,
                startVelocity: 55,
            });
            fire(0.2, {
                spread: 60,
            });
            fire(0.35, {
                spread: 100,
                decay: 0.91,
                scalar: 0.8
            });
            fire(0.1, {
                spread: 120,
                startVelocity: 25,
                decay: 0.92,
                scalar: 1.2
            });
            fire(0.1, {
                spread: 120,
                startVelocity: 45,
            });
        }


        // --- Webcam Functions ---
        async function startWebcam() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                webcamView.srcObject = stream;
                webcamStream = stream; // Store stream to stop it later
                webcamButton.style.display = 'block'; // Show take selfie button
            } catch (err) {
                console.error("Webcam access denied or error: ", err);
                alert("카메라 접근을 허용해주세요. 또는 다른 모드를 이용해주세요. 오류: " + err.message);
                webcamButton.style.display = 'none'; // Hide take selfie button on error
            }
        }

        function stopWebcam() {
            if (webcamStream) {
                webcamStream.getTracks().forEach(track => track.stop());
                webcamView.srcObject = null;
                webcamStream = null;
                webcamButton.style.display = 'none'; // Hide take selfie button
            }
        }

        webcamButton.addEventListener('click', function() {
            if (webcamView.srcObject) {
                const context = webcamCanvas.getContext('2d');
                webcamCanvas.width = webcamView.videoWidth;
                webcamCanvas.height = webcamView.videoHeight;
                context.drawImage(webcamView, 0, 0, webcamView.videoWidth, webcamView.videoHeight);
                const imageData = webcamCanvas.toDataURL('image/png');
                imagePreview.src = imageData;
                imagePreview.style.display = 'block'; // Use display: block
                setTimeout(() => imagePreview.style.opacity = '1', 10); // Fade in
                checkSalaryButton.disabled = false; // Enable button after taking photo
                resetResults(); // Clear previous results and hide share/reset buttons
            } else {
                alert("웹캠이 활성화되지 않았습니다. 잠시 후 다시 시도해주세요.");
            }
        });

        // --- Reset Function ---
        function resetResults() {
            resultText.textContent = '';
            salaryAmountDisplay.textContent = '';
            loadingMessage.style.display = 'none'; // Hide spinner
            shareButton.style.display = 'none';
            kakaoShareButton.style.display = 'none';
            resetButton.style.display = 'none'; // Hide reset button
        }
        
        function resetTest() {
            resetResults();
            imagePreview.src = '#';
            imagePreview.style.opacity = '0'; // Start fade out
            setTimeout(() => { // Wait for fade out to complete before hiding
                imagePreview.style.display = 'none'; 
            }, 500); 
            checkSalaryButton.disabled = true;
            switchMode('upload'); // Go back to default upload mode
        }
        resetButton.addEventListener('click', resetTest);


        // --- Mode Switching Logic ---
        function switchMode(mode) {
            currentMode = mode;
            resetResults(); // Clear results and hide buttons
            checkSalaryButton.disabled = true; // Disable until new image is ready
            imagePreview.style.opacity = '0'; // Hide preview image initially
            setTimeout(() => { // Wait for fade out to complete before hiding
                imagePreview.style.display = 'none'; 
            }, 500);

            if (mode === 'upload') {
                uploadSection.style.display = 'flex';
                webcamSection.style.display = 'none';
                uploadModeBtn.classList.add('active');
                webcamModeBtn.classList.remove('active');
                stopWebcam(); // Stop webcam if switching from webcam mode
            } else if (mode === 'webcam') {
                uploadSection.style.display = 'none';
                webcamSection.style.display = 'flex';
                uploadModeBtn.classList.remove('active');
                webcamModeBtn.classList.add('active');
                startWebcam(); // Start webcam if switching to webcam mode
            }
        }

        uploadModeBtn.addEventListener('click', () => switchMode('upload'));
        webcamModeBtn.addEventListener('click', () => switchMode('webcam'));


        // --- Image Upload Logic ---
        imageUpload.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    imagePreview.src = e.target.result;
                    imagePreview.style.display = 'block'; // Use display: block
                    setTimeout(() => imagePreview.style.opacity = '1', 10); // Fade in
                    checkSalaryButton.disabled = false; // Enable button after taking photo
                    resetResults(); // Clear previous results and hide share/reset buttons
                };
                reader.readAsDataURL(file);
            } else {
                imagePreview.src = '#';
                imagePreview.style.opacity = '0'; // Start fade out
                setTimeout(() => { // Wait for fade out to complete before hiding
                    imagePreview.style.display = 'none'; 
                }, 500);
                checkSalaryButton.disabled = true;
                resetResults();
            }
        });

        // --- Utility for Random Numbers ---
        function getRandomInt(min, max) {
            min = Math.ceil(min);
            max = Math.floor(max);
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        // --- Utility for Korean Won Formatting ---
        function formatKoreanWon(amount) {
            const manUnit = 10000;
            if (amount >= manUnit) {
                const millions = Math.floor(amount / manUnit);
                return `월 ${millions.toLocaleString()}만 원`;
            } else {
                return `월 ${amount.toLocaleString()}원`;
            }
        }


        // --- Prediction Logic ---
        checkSalaryButton.addEventListener('click', predict);

        async function predict() {
            if (!imagePreview.src || imagePreview.style.display === 'none') { // Check display for prediction
                alert("먼저 이미지를 업로드하거나 촬영해주세요!");
                return;
            }

            loadingMessage.style.display = 'flex'; // Show loading message with spinner
            resetResults(); // Clear previous results and hide share/reset buttons (except loading itself)
            checkSalaryButton.disabled = true; // 분석 중에는 버튼 비활성화

            await new Promise(resolve => setTimeout(resolve, 1000)); // 1초 대기

            // Use imagePreview directly for prediction
            const prediction = await model.predict(imagePreview);
            
            loadingMessage.style.display = 'none'; // Hide loading message
            checkSalaryButton.disabled = false; // 버튼 다시 활성화

            let resultMessage = "분석 결과가 명확하지 않습니다. 다른 사진으로 다시 시도해주세요!";
            let salaryAmountNum = 0; // Raw numerical amount
            let highestProbability = 0;
            let predictedClass = '';

            for (let i = 0; i < maxPredictions; i++) {
                if (prediction[i].probability.toFixed(2) > highestProbability) {
                    highestProbability = prediction[i].probability.toFixed(2);
                    predictedClass = prediction[i].className;
                }
            }
            
            switch (predictedClass) {
                case "Class 1": 
                case "부자": 
                    resultMessage = richMessages[Math.floor(Math.random() * richMessages.length)] + " 예상 월급 ";
                    salaryAmountNum = getRandomInt(8_000_000, 30_000_000); // 월 800만 ~ 3,000만
                    break;
                case "Class 2":
                case "중산층":
                    resultMessage = middleClassMessages[Math.floor(Math.random() * middleClassMessages.length)] + " 예상 월급 ";
                    salaryAmountNum = getRandomInt(3_500_000, 6_000_000); // 월 350만 ~ 600만
                    break;
                case "Class 3":
                case "거지":
                    resultMessage = poorMessages[Math.floor(Math.random() * poorMessages.length)] + " 예상 월급 ";
                    salaryAmountNum = getRandomInt(2_200_000, 3_000_000); // 월 220만 ~ 300만
                    break;
                default:
                    resultMessage = "알 수 없는 결과입니다. 다시 시도해주세요!";
                    salaryAmountNum = 0;
            }

            resultText.innerHTML = resultMessage;
            if (salaryAmountNum > 0) {
                salaryAmountDisplay.textContent = formatKoreanWon(salaryAmountNum);
                triggerConfetti(); // Trigger confetti when salary amount is displayed

                // Show share buttons if available
                if (navigator.share) {
                    shareButton.style.display = 'block';
                }
                if (Kakao.isInitialized()) {
                    kakaoShareButton.style.display = 'block';
                }
                resetButton.style.display = 'block'; // Show reset button after result
            }
        }

        // --- Web Share Button Logic ---
        shareButton.addEventListener('click', async () => {
            if (navigator.share) {
                try {
                    const shareData = {
                        title: '미래 월급 테스트 결과',
                        text: `${resultText.textContent}${salaryAmountDisplay.textContent} 에서 나도 미래 월급을 확인해보세요!`,
                        url: window.location.href
                    };
                    await navigator.share(shareData);
                    console.log('Web Share successful');
                } catch (error) {
                    console.error('Error sharing via Web Share:', error);
                    // User might have cancelled the share, or an error occurred
                }
            } else {
                alert('이 브라우저에서는 공유하기 기능을 지원하지 않습니다.');
                console.log('Web Share API not supported in this browser.');
            }
        });

        // --- Kakao Share Function ---
        function shareKakao() {
            if (Kakao.isInitialized()) {
                Kakao.Share.sendDefault({
                    objectType: 'feed',
                    content: {
                        title: '미래 월급 관상 테스트',
                        description: `AI가 분석한 내 미래 월급은 ${resultText.textContent}${salaryAmountDisplay.textContent} 에서 나도 미래 월급을 확인해보세요!`,
                        link: {
                            webUrl: 'https://future-salary-test.pages.dev',
                        },
                    },

                });
            } else {
                alert('카카오 SDK가 초기화되지 않았습니다.');
                console.error('Kakao SDK not initialized.');
            }
        }
        kakaoShareButton.addEventListener('click', shareKakao);

        init(); // 페이지 로드 시 모델 초기화

        // --- Hamburger Menu Toggle Logic ---
        const hamburgerBtn = document.getElementById('hamburger-btn');
        const closeMenuBtn = document.getElementById('close-menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');
        const menuItems = document.querySelectorAll('#mobile-menu .menu-item');

        hamburgerBtn.addEventListener('click', () => {
            mobileMenu.classList.add('open');
        });

        closeMenuBtn.addEventListener('click', () => {
            mobileMenu.classList.remove('open');
        });

        menuItems.forEach(item => {
            item.addEventListener('click', () => {
                mobileMenu.classList.remove('open'); // Close menu on item click
            });
        });
    </script>
</body>
</html>